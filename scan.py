import argparse
import warnings
import numpy as np
from features_extraction import extract_features
from models import models
from cuckoo import cuckoo

# Suppress UserWarning about unpickling estimator
warnings.filterwarnings("ignore", category=UserWarning, message="Trying to unpickle estimator")
# Create the argument parser
parser = argparse.ArgumentParser()

# Add the command line arguments
parser.add_argument('--files', nargs='+', help='List of file paths')

# Parse the arguments
args = parser.parse_args()

# Iterate over the file paths and extract the features
for filepath in args.files:
    #sen file to cuckoo sandbox
    #cuckoo(filepath)
    features = extract_features(filepath)
    print(f'File: {filepath}, Features: {features}')
    # Make a prediction using the machine learning model
    S=np.array(list(features.values()))
    reshaped_sample = S[np.newaxis, :]
    for m in models:
        with warnings.catch_warnings():
            warnings.simplefilter("ignore")
            prediction = m.predict(reshaped_sample)

        # Print the result
        if prediction == 1:
            print(f"The file is predicted to be malware according to {m.__class__.__name__}!!!!!")
        else:
            print(f"The file is predicted to be clean according to {m.__class__.__name__}.")
